<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Projector</title>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/framework7/1.4.2/css/framework7.ios.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

    <style>
    .panel {
      background: inherit;
    }

    .row {
      margin: 1em
    }

    .ok-row .button.button-big {
      height: 96px;
      line-height: 96px;
    }

    .list-block .item-link.active {
      background-color: #007aff;
      color: #fff;
    }

    .remote {
      margin-top: 0em;
      margin-bottom: 3em;
    }

    .icon {
      font-size: 25px !important;
    }
    </style>
  </head>
  <body>
    <div class="statusbar-overlay"></div>
    <div class="panel-overlay"></div>
    
    <div class="panel panel-left panel-reveal">
      <div class="content">
        <div class="content-block-title">Input sources</div>
          <div class="list-block onmode disabled">
            <ul>
              <li>
                <a href="/input/s-video" data-source="s-video" class="press-btn source item-link list-button">S-Video</a>
              </li>
              <li>
                <a href="/input/video" data-source="video" class="press-btn source item-link list-button">Video</a>
              </li>
              <li>
                <a href="/input/computer" data-source="computer" class="press-btn source item-link list-button">Computer</a>
              </li>
              <li>
                <a href="/input/hdmi1" data-source="hdmi1" class="press-btn source item-link list-button">HDMI 1</a>
              </li>
              <li>
                <a href="/input/hdmi2" data-source="hdmi2" class="press-btn source item-link list-button">HDMI 2</a>
              </li>
              {% endfor %}
            </ul>
          </div>
      </div>
    </div>

    <div class="views tabs toolbar-through">
      <div id="view-1" class="view view-main tab active">
        <div class="navbar">
          <div class="navbar-inner">
            <div class="left">
                <a href="#" class="link power">
                    <i class='fa fa-power-off'></i>
                    <span id='powertext'>Power</span>
                </a>
              </div>
            <!-- <div class="center">Remote</div> -->
            <div class="right">
                <a href="#" class="open-panel link onmode">
                    <span>Inputs</span>
                    <i class="fa fa-sign-in"></i>
                </a>
            </div>
          </div>
        </div>
        <div class="pages navbar-through">
          <div data-page="index-1" class="page onmode">
            <div class="page-content">
              <div class="content-block">
                
                <div class='remote'>
                <div class="row">
                  <div class="col-20">
                    <a href="/press/menu" class="press-btn button button-big button-round  button-red "><i class='fa fa-bars'></i></a>
                  </div>
                  <div class="col-60">
                    <a href="/press/up" class="press-btn button button-big button-round  button-red "><i class='fa fa-arrow-up'></i></a>
                  </div>
                  <div class="col-20">
                    <a href="/press/back" class="press-btn button button-big button-round  button-red "><i class='fa fa-undo'></i></a>
                  </div>
                </div>
                <div class="row ok-row">
                  <div class="col-20">
                    <a href="/press/left" class="press-btn button button-big button-round button-green "><i class='fa fa-arrow-left'></i></a>
                  </div>
                  <div class="col-60">
                    <a href="/press/ok" class="press-btn button button-big button-round button-green">OK</a>
                  </div>
                  <div class="col-20">
                    <a href="/press/right" class="press-btn button button-big button-round  button-green "><i class='fa fa-arrow-right'></i></a>
                  </div>
                </div>
                <div class="row">
                  <div class="col-20"></div>
                  <div class="col-60">
                    <a href="/press/down" class="press-btn button button-big button-round button-red "><i class='fa fa-arrow-down'></i></a>
                  </div>
                  <div class="col-20"></div>
                </div>
                </div>

                <p class="buttons-row">
                  <a href="/press/test" class="press-btn button"><i class='fa fa-flask'></i> Test</a>
                  <a href="/press/hide" class="press-btn button"><i class='fa fa-eye-slash'></i> Hide</a>
                  <a href="/press/info" class="press-btn button"><i class='fa fa-info'></i> Info</a>
                </p>

                <!-- <div class="content-block-title">Lens Control</div> -->

                <p class="buttons-row">
                  <a href="/press/lens" class="press-btn button">Lens</a>
                  <a href="/press/lens_aperture" class="press-btn button">Aperture</a>
                  <a href="/press/aspect" class="press-btn button">Aspect</a>
                </p>

              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="view-2" class="view tab">
        <div class="navbar">
          <div class="navbar-inner">
            <div class="center sliding">Appearance Controls</div>
          </div>
        </div>
        <div class="pages navbar-through">
          <div data-page="index-2" class="page onmode">
            <div class="page-content">
             <div class="list-block">
                <ul>
                  <li><a href="/press/stage" class="press-btn item-link list-button">Stage</a></li>
                  <li><a href="/press/cinema1" class="press-btn item-link list-button">Cinema 1</a></li>
                  <li><a href="/press/cinema2" class="press-btn item-link list-button">Cinema 2</a></li>
                  <li><a href="/press/dynamic" class="press-btn item-link list-button">Dynamic</a></li>
                  <li><a href="/press/user1" class="press-btn item-link list-button">User 1</a></li>
                  <li><a href="/press/user2" class="press-btn item-link list-button">User 2</a></li>
                  <li><a href="/press/user3" class="press-btn item-link list-button">User 3</a></li>
                </ul>
              </div>

              <div class="content-block">
                <div class="content-block-title">Video Control</div>

                  <p class="buttons-row">
                    <a href="/press/color" class="press-btn button">Color</a>
                    <a href="/press/tint" class="press-btn button">Tint</a>
                    <a href="/press/noise_reduction" class="press-btn button">Noise Reduce</a>
                  </p>

                  <p class="buttons-row">
                    <a href="/press/brightness" class="press-btn button">Brightness</a>
                    <a href="/press/contrast" class="press-btn button">Contrast</a>
                    <a href="/press/sharpness" class="press-btn button">Sharpness</a>
                  </p>

                  <p class="buttons-row">
                    <a href="/press/gamma" class="press-btn button">Gamma</a>
                    <a href="/press/color_temp" class="press-btn button">Color Temperature</a>
                  </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="toolbar onmode tabbar tabbar-labels tabbar-labels-fixed toolbar-fixed">
        <div class="toolbar-inner"><a href="#view-1" class="tab-link active"> <i class="icon fa fa-th"></i><span class="tabbar-label">Remote</span></a>

        <a href="#view-2" class="tab-link"><i class="icon fa fa-sliders"></i><span class="tabbar-label">Video</span></a>

      </div>
    </div>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/framework7/1.4.2/js/framework7.min.js"></script>
    <script>
      document.projectorState = {
        mode: 'unknown',
        input: null,
        model: 'Unknown'
      }
    </script>
    <script>
      var projectorApp = new Framework7({
        ajaxLinks: ' ', // you can't disable this; wtf?!
        swipePanel: 'left',
      });

      // Export selectors engine
      var $$ = Dom7;

      // Add views
      var view1 = projectorApp.addView('#view-1');
      var view2 = projectorApp.addView('#view-2');

      $$('.power').on('click', function () {
        if (document.projectorState.mode == 'standby') {
          $$.getJSON ('/on', null, function (res) {
            if (res.success) {
              document.waitingForState = 'power-on';
              projectorApp.showPreloader('Turning on...');
            } else {
              projectorApp.alert ("Failed to turn on projector.")
            }
          });
        } else {
            projectorApp.confirm("You're about to turn off the projector.", 'Turn off projector?', function () {
                $$.getJSON ('/off', null, function (res) {
                  if (res.success) {
                    projectorApp.showPreloader('Turning off...');
                    document.waitingForState = 'standby';
                } else {
                  projectorApp.alert ("Failed to turn off projector.")
                }
                });
            });
        }
      });

      document.onStateUpdate = function () {
        if (document.projectorState.mode == 'power-on') {
          $$('.onmode').removeClass ('disabled');
        } else {
          $$('.onmode').addClass ('disabled');
        }

        switch (document.projectorState.mode) {
          case 'power-on':
            $$('#powertext').text ("Power off");
            $$('.power').removeClass ('disabled');
            break;
          case 'standby':
            $$('#powertext').text ("Power on");
            $$('.power').removeClass ('disabled');
            break;
          case 'cool-down':
            $$('#powertext').text ("Cooling down...");
            $$('.power').addClass ('disabled');
            break;
          case 'warning':
            $$('#powertext').text ("Warning!");
            $$('.power').removeClass ('disabled');
            // $$('.power').addClass ('disabled');
            break;
        }

        // update selected source
        console.log ('have input',document.projectorState.input);
        $$.each ($$('.source'), function (idx, val) {
          console.log ('have val', val);
          if ($$(val).data ("source") == document.projectorState.input) {
            console.log ('was input!');
            $$(val).addClass ('active');
          } else {
            $$(val).removeClass ('active');
          }
        });
      }

      document.updateInterval = setInterval (function () {
        console.log ('getting status');
        $$.getJSON('/status', function (data) {
          document.projectorState = data;
          document.onStateUpdate();

          if (data.mode == document.waitingForState) {
            projectorApp.hidePreloader();
            document.waitingForState = null;
          }
        })
      }, 800);

      $$('.press-btn').on ('click', function (e) {
        e.preventDefault(); // FIXME: throws an exception inside framework7, but does what we want
        $$.get($$(e.target).attr('href'));
      });


      document.onStateUpdate();
    </script>
  </body>
</html>